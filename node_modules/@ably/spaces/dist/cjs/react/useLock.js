"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useLock = void 0;
const react_1 = require("react");
const SpaceContext_js_1 = require("./contexts/SpaceContext.js");
/*
 * Returns the status of a lock and, if it has been acquired, the member holding the lock
 */
function useLock(lockId) {
    const space = (0, react_1.useContext)(SpaceContext_js_1.SpaceContext);
    const [status, setStatus] = (0, react_1.useState)(null);
    const [member, setMember] = (0, react_1.useState)(null);
    const initialized = status !== null;
    (0, react_1.useEffect)(() => {
        if (!space)
            return;
        const handler = (lock) => {
            if (lock.id !== lockId)
                return;
            if (lock.status === 'unlocked') {
                setStatus(null);
                setMember(null);
            }
            else {
                setStatus(lock.status);
                setMember(lock.member);
            }
        };
        space.locks.subscribe('update', handler);
        return () => {
            space === null || space === void 0 ? void 0 : space.locks.unsubscribe('update', handler);
        };
    }, [space, lockId]);
    (0, react_1.useEffect)(() => {
        if (initialized || !space)
            return;
        const lock = space === null || space === void 0 ? void 0 : space.locks.get(lockId);
        if (lock) {
            setMember(lock.member);
            setStatus(lock.status);
        }
    }, [initialized, space]);
    return { status, member };
}
exports.useLock = useLock;
//# sourceMappingURL=useLock.js.map