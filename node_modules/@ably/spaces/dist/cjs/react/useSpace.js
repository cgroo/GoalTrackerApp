"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useSpace = void 0;
const react_1 = require("react");
const SpaceContext_js_1 = require("./contexts/SpaceContext.js");
const useChannelState_js_1 = require("./useChannelState.js");
const useConnectionState_js_1 = require("./useConnectionState.js");
const useSpace = (callback, options) => {
    const space = (0, react_1.useContext)(SpaceContext_js_1.SpaceContext);
    const callbackRef = (0, react_1.useRef)(callback);
    const channelError = (0, useChannelState_js_1.useChannelState)(space === null || space === void 0 ? void 0 : space.channel);
    const connectionError = (0, useConnectionState_js_1.useConnectionState)();
    (0, react_1.useEffect)(() => {
        callbackRef.current = callback;
    }, [callback]);
    (0, react_1.useEffect)(() => {
        if (callbackRef.current && space && !(options === null || options === void 0 ? void 0 : options.skip)) {
            const listener = (params) => {
                var _a;
                (_a = callbackRef.current) === null || _a === void 0 ? void 0 : _a.call(callbackRef, params);
            };
            space.subscribe('update', listener);
            return () => space.unsubscribe('update', listener);
        }
    }, [space, options === null || options === void 0 ? void 0 : options.skip]);
    return {
        space,
        enter: space === null || space === void 0 ? void 0 : space.enter.bind(space),
        leave: space === null || space === void 0 ? void 0 : space.leave.bind(space),
        updateProfileData: space === null || space === void 0 ? void 0 : space.updateProfileData.bind(space),
        connectionError,
        channelError,
    };
};
exports.useSpace = useSpace;
//# sourceMappingURL=useSpace.js.map