import { useContext, useEffect, useRef } from 'react';
import { SpaceContext } from './contexts/SpaceContext.js';
import { isArray, isFunction, isString } from '../utilities/is.js';
/*
 * Registers a subscription on the `Space.locations` object
 */
function useLocations(eventOrCallback, callbackOrOptions, optionsOrNothing) {
    const space = useContext(SpaceContext);
    const locations = space === null || space === void 0 ? void 0 : space.locations;
    const callback = isString(eventOrCallback) || isArray(eventOrCallback)
        ? callbackOrOptions
        : eventOrCallback;
    const options = isFunction(callbackOrOptions) ? optionsOrNothing : callbackOrOptions;
    const callbackRef = useRef(callback);
    useEffect(() => {
        callbackRef.current = callback;
    }, [callback]);
    useEffect(() => {
        if (callbackRef.current && locations && !(options === null || options === void 0 ? void 0 : options.skip)) {
            const listener = (params) => {
                var _a;
                (_a = callbackRef.current) === null || _a === void 0 ? void 0 : _a.call(callbackRef, params);
            };
            if (!isFunction(eventOrCallback) && eventOrCallback) {
                locations.subscribe(eventOrCallback, listener);
            }
            else {
                locations.subscribe(listener);
            }
            return () => {
                if (!isFunction(eventOrCallback) && eventOrCallback) {
                    locations.unsubscribe(eventOrCallback, listener);
                }
                else {
                    locations.unsubscribe(listener);
                }
            };
        }
    }, [locations, options === null || options === void 0 ? void 0 : options.skip]);
    return {
        space,
        update: locations === null || locations === void 0 ? void 0 : locations.set.bind(locations),
    };
}
export { useLocations };
//# sourceMappingURL=useLocations.js.map